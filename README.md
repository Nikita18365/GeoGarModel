# GeoGarModel
Software package for geological and geophysical modeling of ground and aerial survey data

# Главное окно программы:
Главное окно программы представлено пространством для визуализации грид файлов регулярной и нерегулярной сети формата *zmap. Пример файла формата *.zmap можно получить путем экспорта грид файла в формат *.zmap в программном обеспечении Surfer 16. Примеры файлов Zmap также представлены в главном дистрибутиве программы.
В правой части располагается список загруженных файлов формата *.zmap. При нажатии на соответствующий файл будет происходить его визуализация в левом окошке со стандартными элементами оформления, а именно:
 - цветовая шкала rainbow
- гистограммное цветовое распределение
- без названия карты
- без подписи цветовой шкалы
Под списком загруженных файлов располагаются элементы изменения оформления карты, которые включают в себя:
- Минимальное значение цветового отображения
- Максимальное значение цветового отображения
- Цветовая шкала:
1) hsv
2) bwr
3) colorwarm
4) gist_rainbow
5) ocean
6) rainbow
7) seismic
8) tab20c
9) terrain
10) twilight
11) twilight_shifted
![image](https://github.com/user-attachments/assets/35c4becd-260b-4b18-a758-65778f58f4cf)
- Название карты
- Подпись цветовой шкалы (справа от цветовой шкалы; rotate = 90)
Под элементами оформления карты находятся 3 кнопки:
1)	«Построить точки обучающей и тестовой выборки». После загрузки обучающего СС датасета, точки обучающей и контрольной (валидационной) выборок можно визуализировать на карте. !Система координат (СК) отображающегося *.zmap файла должна совпадать с СК обучающего датасета для корректной визуализации.
2)	«Добавить shp файл». После загрузки одного или нескольких файлов формата *.shp их можно визуализировать на карте. !Система координат (СК) отображающегося *.zmap файла должна совпадать с СК файла формата *.shp для корректной визуализации.
3)	Кнопка «ОК». При нажатии данной кнопки для уже отображающегося файла формата *.zmap обновляются его элементы оформления. !При этом пункты 1 и 2 полностью удаляются с карты, но сами файлы сохраняются в корне программы и повторная их загрузка не требуется.
# Элементы зума:
В верхней части программы располагается следующая иконка:

 ![image](https://github.com/user-attachments/assets/30b68ec6-c35e-4d2e-b108-f9e7cc04e97d)
 
При нажатии левой кнопкой мыши на данную иконку происходит возврат к стандартному разрешению с возвратом всех элементов, которые были на карте в момент увеличения зума.
Также пользователь может приблизить и отдалить карту. Приближение осуществляется за счет нажатия на следующую кнопку в элементе тулбара:

 ![image](https://github.com/user-attachments/assets/22e015b8-e413-4762-84f5-a1de44880ace)
 
Для отдаления используется иконка:

 ![image](https://github.com/user-attachments/assets/b222a203-e9db-4ff1-8507-b0aaba33518c)
 
Пользователю достаточно нажать 1 раз левой кнопкой мыши в любой области карты для уменьшения масштаба карты на 10% по обоим осям.
# Элемент меню – «Загрузка данных»

1) Загрузить обучающую СС выборку

Данная кнопка реализует загрузку одного файла обучающей выборки (обучающийся участок) формата *.xlsx.
Пример входного файла:

![image](https://github.com/user-attachments/assets/f46fc002-e967-458f-9caf-2e341b388d60)

Первые 2 столбца обязательно должны содержать в себе координаты атрибутов (X, Y).
Далее, начиная с 3 столбца идут признаки, по которым будет происходить обучение.
Кодировка xlsx или xls файла – обязательно UTF8.
Последний столбец является целевой переменной, которая будет предсказываться.

2) Загрузить прогнозную выборку

Данная кнопка реализует загрузку одного файла прогнозной выборки (прогнозный участок) формата *.xlsx.
Файл ничем не отличается от файла обучающей СС выборки за исключением последнего столбца. Для прогнозной выборки целевая переменная неизвестна. Если кол-во столбцов обучающей СС выборки 15, то прогнозной должно быть 14.
- Загрузить shp файл
Данная кнопка реализует загрузку одного или нескольких файлов формата *.shp. !В папке с файлом формата *.shp должны находиться сцепленные с ним файлы следующих форматов:
- *.dbf
- *.prj
- *.sbn
- *.shx
Все названия добавленных *.shp файлов находятся в главном окне программы. При нажатии левой кнопкой мыши пользователь может поменять цвет и толщину линии. Директория расположения shp файла может быть любой (не обязательно в дистрибутиве программы)
Для очистки карты от *.shp файлов достаточно нажать кнопку «ОК» в главном окне программы. Если пользователь захочет визуализировать *.shp файлы снова, он может это сделать также нажав кнопку «Добавить shp файл». Файлы визуализируются с тем же цветом и той же толщиной линии. Пример:

![image](https://github.com/user-attachments/assets/e6cc00c7-c922-428b-a435-0ef482137c52)

3) Загрузить Zmap файл

Данная кнопка реализует загрузку одного или нескольких файлов формата *.zmap. Файлы Zmap должны располагаться в главном дистрибутиве программы, без подпапок.
# Элемент меню – «Просмотр данных»
1) Просмотр данных СС выборки

Данная функция реализует просмотр и редактирование данных обучающей СС выборки. Пример визуализации:

![image](https://github.com/user-attachments/assets/2e78cd49-600a-4a47-8616-34b0a1f2acd2)

2) Просмотр данных прогнозной выборки

Данная функция реализует просмотр и редактирование данных прогнозной выборки.
# Элемент меню – «Визуализация данных»
- Визуализация данных СС выборки

После загрузки СС выборки пользователь может визуализировать её.

- Визуализация данных прогнозной выборки

После загрузки прогнозной выборки пользователь может визуализировать её.

- Визуализация y_pred

После этапа подбора оптимальных гиперпараметров пользователь может визуализировать предсказанные значения (1), данные целевой переменной train выборки (2) и разность предсказанных значений с test выборкой (3). Под графиками располагается 3 кнопки при помощи которых пользователь может экспортировать нужную ему карту в формате *.txt. Первый и второй столбец файла отвечают координатам (X,Y), а третий столбец экспортируемой целевой переменной.

![image](https://github.com/user-attachments/assets/04e6a903-69ac-4885-b9e4-be7063103bf9)

# Элемент меню – «Статистические характеристики данных»
- Статистические характеристики данных СС выборки
- Статистические характеристики данных прогнозной выборки
После загрузки данных обучающей СС выборки пользователь может проанализировать основные статистические хар-ки всех атрибутов, такие как:
- Среднее значение
- Стандартное отклонение
- Минимум
- Максимум
- Квантиль 25%
- Квантиль 75%
Пример:

![image](https://github.com/user-attachments/assets/10dbabd9-96fc-423d-b9ae-6e7bf75d2354)

# Shapely Plot
Математическая основа расчета Shapley значения:
Shapely values в теории игр:
Теория игр - это область математики, изучающей взаимодействие (игру) между игроками, преследующими некие цели и действующими по неким правилам. Кооперативной игрой называется такая игра, в которых группа игроков (коалиция) действует совместно. С середины XX века (Shapley, 1952) известны так называмые Shapley values, которые позволяют численно оценить вклад каждого игрока в достижение общей цели.
Примечание. Понятие "игра" в данном случае может ввести в заблуждение. Обычно под игрой понимается противостояние двух и более сторон, здесь же речь пойдет скорее о кооперативном процессе, в котором каждый участник вносит вклад в общий результат.
Пусть существует характеристическая функция υ, которая каждому множеству игроков сопоставляет число - эффективность данной коалиции игроков, действующей совместно. Тогда Shapley value для каждого игрока - это число, рассчитываемое по достаточно простой формуле. Обозначим за за Δ(i,S) прирост эффективности от добавления игрока i в коалицию игроков S:

![image](https://github.com/user-attachments/assets/b60d5058-e70e-4745-804d-cc2d1d6ce6f8)

Пусть всего есть N игроков. Рассмотрим множество П всех возможных упорядочиваний игроков, и обозначим за (players before i in π) множество игроков, стоящих перед игроков i в упорядочивании π. Shapley value для игрока i рассчитывается таким образом:

![image](https://github.com/user-attachments/assets/edab8c83-1f80-4bbd-b2b9-2e9413a5f619)

То есть мы считаем средний прирост эффективности от добавления i-го игрока в коалицию игроков, стоящих перед ним, по всем возможным упорядочиваниям игроков (количество элементов суммы равно N!).
Формула выше задается аксиоматически, то есть формулируется ряд необходимых свойств и доказывается, что данное решение является единственным, которое им удовлетворяет. Поскольку Δ(i,S) не зависит от порядка игроков в S, то можно объединить равные друг другу слагаемые и переписать формулу в следующем эквивалентном виде:

![image](https://github.com/user-attachments/assets/91e76bdf-1f05-4c46-859e-a6babe3e4331)

Формула является взвешенной суммой по всем подмножествам игроков, не содержащих игрока i, в которой веса принимают наибольшие значения при |S|≈0 или |S|≈ |N| и наименьшие значения при |S|≈ |N|/2.

1) Bar Shapely Plot
2) 
При нажатии на кнопку Bar Shapely Plot создает гистограмму из набора значений SHAP для тренировочной выборки.
Пример:

![image](https://github.com/user-attachments/assets/5f8d560a-ef79-4b61-8004-d7fbb13d10a1)

На гистограмме представлены средние значения Shap Value для 13 признаков. Схема читается снизу вверх, и признаки упорядочены по возрастанию их SHAP values. Например, SHAP value для признака Grav_Trend3 (имеющего значение -19.5) говорит о том, что данный атрибут уменьшает величину предсказания модели, по сравнению с отсутствием этого признака, при произвольном наличии других признаков. Таким же образом себя ведет и GravTrend1, Ostat_GravMagInv, GravReg10km, GravReg2km.

2) Beeswarm Shapely Plot

График «basewarm plot» предназначен для отображения подробной информации о том, как основные характеристики набора данных влияют на результаты модели. Каждый экземпляр, для которого дано объяснение, представлен одной точкой на каждой оси. Положение точки по оси X определяется значением SHAP (shap_values.value[instance,feature]) для этой характеристики, и точки «нагромождаются» вдоль каждой строки характеристик, чтобы показать плотность. Цвет используется для отображения исходного значения характеристики (shap_values.data[instance,feature]). На графике ниже мы видим, что пониженные значения региональной составляющей гравитационного поля и глубины границы Мохоровичича имеют повышенное влияние в модели, по сравнению с другими признаками.

![image](https://github.com/user-attachments/assets/ffd9e35b-974c-4b4c-b840-db3ef2ff7ad9)

3) Heatmap Shapely Plot

При передаче матрицы значений SHAP в функцию построения тепловой карты создаётся график с примерами по оси X, входными данными модели по оси Y и значениями SHAP, закодированными в цветовой шкале. По умолчанию образцы упорядочиваются с помощью shap.order.hclust, которая упорядочивает образцы на основе иерархической кластеризации по сходству их объяснений. В результате образцы с одинаковым результатом модели по одной и той же причине группируются вместе.
Выходные данные модели отображаются над матрицей тепловой карты (в центре которой находится .base_value), а глобальная важность каждого входного параметра модели отображается в виде гистограммы в правой части графика (по умолчанию это shap.order.abs.mean показатель общей важности).

![image](https://github.com/user-attachments/assets/c862ad8d-0380-42a8-9aea-120c2aec80d1)
# Элемент меню – «Train_Test»


